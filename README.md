TODO:
 - [ ] Clean up code with named parameters
 - [ ] We're not actually calculating message length on the fixed header
