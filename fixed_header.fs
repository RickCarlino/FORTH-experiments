INCLUDE object.fs
INCLUDE constants.fs
INCLUDE twiddle.fs

\ MQTT PACKET STRUCTURE
\ HTTP://PUBLIC.DHE.IBM.COM/SOFTWARE/DW/WEBSERVICES/WS-MQTT/MQTT-V3R1.HTML#MSG-FORMAT

MQ:OBJECT CLASS MQ:FIXED-HEADER
    METHOD TO-BINARY

    1 CHARS VAR FLAGS
    1 CHARS VAR LENGTH

  HOW:

    : INIT ( MESSAGE-TYPE DUP-FLAG QOS-LEVEL RETAIN LENGTH -- SELF )
      LENGTH C! OR OR OR FLAGS C! ;

    : TO-BINARY ( SELF -- 16 bits )
      FLAGS C@ 8 LSHIFT LENGTH C@ OR ;
CLASS;

2 base !

\ CREATE A NEW MQTT HEADER.

MQ:DISCONNECT MQ:NO-DUP MQ:AT-LEAST-ONCE MQ:RETAIN 1 MQ:FIXED-HEADER : MY-HEADER

MY-HEADER TO-BINARY
.s
\ MY-HEADER PRINT

MY-HEADER DISPOSE

cr

bye
